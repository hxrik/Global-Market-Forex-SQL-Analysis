CREATE WAREHOUSE IF NOT EXISTS ANALYTICS_WH
WITH WAREHOUSE_SIZE = 'SMALL'
AUTO_SUSPEND = 60
AUTO_RESUME = TRUE;

USE WAREHOUSE ANALYTICS_WH;


BARCLAYS_ECON_DB.CLEAN.ECON_STAGECREATE OR REPLACE DATABASE BARCLAYS_ECON_DB;
CREATE OR REPLACE SCHEMA BARCLAYS_ECON_DB.CLEAN;

USE DATABASE BARCLAYS_ECON_DB;
USE SCHEMA CLEAN;

CREATE OR REPLACE TABLE GDP_GROWTH (
    Country_Name VARCHAR,
    Country_Code VARCHAR,
    Y1960 FLOAT, Y1961 FLOAT, Y1962 FLOAT, Y1963 FLOAT, Y1964 FLOAT,
    Y1965 FLOAT, Y1966 FLOAT, Y1967 FLOAT, Y1968 FLOAT, Y1969 FLOAT,
    Y1970 FLOAT, Y1971 FLOAT, Y1972 FLOAT, Y1973 FLOAT, Y1974 FLOAT,
    Y1975 FLOAT, Y1976 FLOAT, Y1977 FLOAT, Y1978 FLOAT, Y1979 FLOAT,
    Y1980 FLOAT, Y1981 FLOAT, Y1982 FLOAT, Y1983 FLOAT, Y1984 FLOAT,
    Y1985 FLOAT, Y1986 FLOAT, Y1987 FLOAT, Y1988 FLOAT, Y1989 FLOAT,
    Y1990 FLOAT, Y1991 FLOAT, Y1992 FLOAT, Y1993 FLOAT, Y1994 FLOAT,
    Y1995 FLOAT, Y1996 FLOAT, Y1997 FLOAT, Y1998 FLOAT, Y1999 FLOAT,
    Y2000 FLOAT, Y2001 FLOAT, Y2002 FLOAT, Y2003 FLOAT, Y2004 FLOAT,
    Y2005 FLOAT, Y2006 FLOAT, Y2007 FLOAT, Y2008 FLOAT, Y2009 FLOAT,
    Y2010 FLOAT, Y2011 FLOAT, Y2012 FLOAT, Y2013 FLOAT, Y2014 FLOAT,
    Y2015 FLOAT, Y2016 FLOAT, Y2017 FLOAT, Y2018 FLOAT, Y2019 FLOAT,
    Y2020 FLOAT, Y2021 FLOAT, Y2022 FLOAT, Y2023 FLOAT, Y2024 FLOAT
);


CREATE OR REPLACE TABLE INFLATION (
    Country_Name VARCHAR,
    Country_Code VARCHAR,
    Y1960 FLOAT, Y1961 FLOAT, Y1962 FLOAT, Y1963 FLOAT, Y1964 FLOAT,
    Y1965 FLOAT, Y1966 FLOAT, Y1967 FLOAT, Y1968 FLOAT, Y1969 FLOAT,
    Y1970 FLOAT, Y1971 FLOAT, Y1972 FLOAT, Y1973 FLOAT, Y1974 FLOAT,
    Y1975 FLOAT, Y1976 FLOAT, Y1977 FLOAT, Y1978 FLOAT, Y1979 FLOAT,
    Y1980 FLOAT, Y1981 FLOAT, Y1982 FLOAT, Y1983 FLOAT, Y1984 FLOAT,
    Y1985 FLOAT, Y1986 FLOAT, Y1987 FLOAT, Y1988 FLOAT, Y1989 FLOAT,
    Y1990 FLOAT, Y1991 FLOAT, Y1992 FLOAT, Y1993 FLOAT, Y1994 FLOAT,
    Y1995 FLOAT, Y1996 FLOAT, Y1997 FLOAT, Y1998 FLOAT, Y1999 FLOAT,
    Y2000 FLOAT, Y2001 FLOAT, Y2002 FLOAT, Y2003 FLOAT, Y2004 FLOAT,
    Y2005 FLOAT, Y2006 FLOAT, Y2007 FLOAT, Y2008 FLOAT, Y2009 FLOAT,
    Y2010 FLOAT, Y2011 FLOAT, Y2012 FLOAT, Y2013 FLOAT, Y2014 FLOAT,
    Y2015 FLOAT, Y2016 FLOAT, Y2017 FLOAT, Y2018 FLOAT, Y2019 FLOAT,
    Y2020 FLOAT, Y2021 FLOAT, Y2022 FLOAT, Y2023 FLOAT, Y2024 FLOAT
);


CREATE OR REPLACE TABLE LENDING_INTEREST (
    Country_Name VARCHAR,
    Country_Code VARCHAR,
    Y1960 FLOAT, Y1961 FLOAT, Y1962 FLOAT, Y1963 FLOAT, Y1964 FLOAT,
    Y1965 FLOAT, Y1966 FLOAT, Y1967 FLOAT, Y1968 FLOAT, Y1969 FLOAT,
    Y1970 FLOAT, Y1971 FLOAT, Y1972 FLOAT, Y1973 FLOAT, Y1974 FLOAT,
    Y1975 FLOAT, Y1976 FLOAT, Y1977 FLOAT, Y1978 FLOAT, Y1979 FLOAT,
    Y1980 FLOAT, Y1981 FLOAT, Y1982 FLOAT, Y1983 FLOAT, Y1984 FLOAT,
    Y1985 FLOAT, Y1986 FLOAT, Y1987 FLOAT, Y1988 FLOAT, Y1989 FLOAT,
    Y1990 FLOAT, Y1991 FLOAT, Y1992 FLOAT, Y1993 FLOAT, Y1994 FLOAT,
    Y1995 FLOAT, Y1996 FLOAT, Y1997 FLOAT, Y1998 FLOAT, Y1999 FLOAT,
    Y2000 FLOAT, Y2001 FLOAT, Y2002 FLOAT, Y2003 FLOAT, Y2004 FLOAT,
    Y2005 FLOAT, Y2006 FLOAT, Y2007 FLOAT, Y2008 FLOAT, Y2009 FLOAT,
    Y2010 FLOAT, Y2011 FLOAT, Y2012 FLOAT, Y2013 FLOAT, Y2014 FLOAT,
    Y2015 FLOAT, Y2016 FLOAT, Y2017 FLOAT, Y2018 FLOAT, Y2019 FLOAT,
    Y2020 FLOAT, Y2021 FLOAT, Y2022 FLOAT, Y2023 FLOAT, Y2024 FLOAT
);


CREATE OR REPLACE TABLE EXCHANGE_RATE (
    Country_Name VARCHAR,
    Country_Code VARCHAR,
    Y1960 FLOAT, Y1961 FLOAT, Y1962 FLOAT, Y1963 FLOAT, Y1964 FLOAT,
    Y1965 FLOAT, Y1966 FLOAT, Y1967 FLOAT, Y1968 FLOAT, Y1969 FLOAT,
    Y1970 FLOAT, Y1971 FLOAT, Y1972 FLOAT, Y1973 FLOAT, Y1974 FLOAT,
    Y1975 FLOAT, Y1976 FLOAT, Y1977 FLOAT, Y1978 FLOAT, Y1979 FLOAT,
    Y1980 FLOAT, Y1981 FLOAT, Y1982 FLOAT, Y1983 FLOAT, Y1984 FLOAT,
    Y1985 FLOAT, Y1986 FLOAT, Y1987 FLOAT, Y1988 FLOAT, Y1989 FLOAT,
    Y1990 FLOAT, Y1991 FLOAT, Y1992 FLOAT, Y1993 FLOAT, Y1994 FLOAT,
    Y1995 FLOAT, Y1996 FLOAT, Y1997 FLOAT, Y1998 FLOAT, Y1999 FLOAT,
    Y2000 FLOAT, Y2001 FLOAT, Y2002 FLOAT, Y2003 FLOAT, Y2004 FLOAT,
    Y2005 FLOAT, Y2006 FLOAT, Y2007 FLOAT, Y2008 FLOAT, Y2009 FLOAT,
    Y2010 FLOAT, Y2011 FLOAT, Y2012 FLOAT, Y2013 FLOAT, Y2014 FLOAT,
    Y2015 FLOAT, Y2016 FLOAT, Y2017 FLOAT, Y2018 FLOAT, Y2019 FLOAT,
    Y2020 FLOAT, Y2021 FLOAT, Y2022 FLOAT, Y2023 FLOAT, Y2024 FLOAT
);


CREATE OR REPLACE STAGE ECON_STAGE;

CREATE OR REPLACE TABLE LENDING_INTEREST_CLEAN AS
SELECT 
    COUNTRY_NAME,
    COUNTRY_CODE,
    CAST(REPLACE(YEAR_COLUMN, 'Y', '') AS INT) AS YEAR,
    VALUE_COLUMN AS LENDING_INTEREST
FROM LENDING_INTEREST
UNPIVOT INCLUDE NULLS( VALUE_COLUMN FOR YEAR_COLUMN IN (
    Y1960, Y1961, Y1962, Y1963, Y1964, Y1965, Y1966, Y1967, Y1968, Y1969,
    Y1970, Y1971, Y1972, Y1973, Y1974, Y1975, Y1976, Y1977, Y1978, Y1979,
    Y1980, Y1981, Y1982, Y1983, Y1984, Y1985, Y1986, Y1987, Y1988, Y1989,
    Y1990, Y1991, Y1992, Y1993, Y1994, Y1995, Y1996, Y1997, Y1998, Y1999,
    Y2000, Y2001, Y2002, Y2003, Y2004, Y2005, Y2006, Y2007, Y2008, Y2009,
    Y2010, Y2011, Y2012, Y2013, Y2014, Y2015, Y2016, Y2017, Y2018, Y2019,
    Y2020, Y2021, Y2022, Y2023, Y2024
) );


CREATE OR REPLACE TABLE GDP_GROWTH_CLEAN AS
SELECT 
    COUNTRY_NAME,
    COUNTRY_CODE,
    CAST(REPLACE(YEAR_COLUMN, 'Y', '') AS INT) AS YEAR,
    VALUE_COLUMN AS GDP_GROWTH
FROM GDP_GROWTH
UNPIVOT INCLUDE NULLS( VALUE_COLUMN FOR YEAR_COLUMN IN (
    Y1960, Y1961, Y1962, Y1963, Y1964, Y1965, Y1966, Y1967, Y1968, Y1969,
    Y1970, Y1971, Y1972, Y1973, Y1974, Y1975, Y1976, Y1977, Y1978, Y1979,
    Y1980, Y1981, Y1982, Y1983, Y1984, Y1985, Y1986, Y1987, Y1988, Y1989,
    Y1990, Y1991, Y1992, Y1993, Y1994, Y1995, Y1996, Y1997, Y1998, Y1999,
    Y2000, Y2001, Y2002, Y2003, Y2004, Y2005, Y2006, Y2007, Y2008, Y2009,
    Y2010, Y2011, Y2012, Y2013, Y2014, Y2015, Y2016, Y2017, Y2018, Y2019,
    Y2020, Y2021, Y2022, Y2023, Y2024
) );


CREATE OR REPLACE TABLE INFLATION_RATE_CLEAN AS
SELECT 
    COUNTRY_NAME,
    COUNTRY_CODE,
    CAST(REPLACE(YEAR_COLUMN, 'Y', '') AS INT) AS YEAR,
    VALUE_COLUMN AS INFLATION_RATE
FROM INFLATION
UNPIVOT INCLUDE NULLS( VALUE_COLUMN FOR YEAR_COLUMN IN (
    Y1960, Y1961, Y1962, Y1963, Y1964, Y1965, Y1966, Y1967, Y1968, Y1969,
    Y1970, Y1971, Y1972, Y1973, Y1974, Y1975, Y1976, Y1977, Y1978, Y1979,
    Y1980, Y1981, Y1982, Y1983, Y1984, Y1985, Y1986, Y1987, Y1988, Y1989,
    Y1990, Y1991, Y1992, Y1993, Y1994, Y1995, Y1996, Y1997, Y1998, Y1999,
    Y2000, Y2001, Y2002, Y2003, Y2004, Y2005, Y2006, Y2007, Y2008, Y2009,
    Y2010, Y2011, Y2012, Y2013, Y2014, Y2015, Y2016, Y2017, Y2018, Y2019,
    Y2020, Y2021, Y2022, Y2023, Y2024
) );


CREATE OR REPLACE TABLE EXCHANGE_RATE_CLEAN AS
SELECT 
    COUNTRY_NAME,
    COUNTRY_CODE,
    CAST(REPLACE(YEAR_COLUMN, 'Y', '') AS INT) AS YEAR,
    VALUE_COLUMN AS EXCHANGE_RATE
FROM EXCHANGE_RATE
UNPIVOT INCLUDE NULLS( VALUE_COLUMN FOR YEAR_COLUMN IN (
    Y1960, Y1961, Y1962, Y1963, Y1964, Y1965, Y1966, Y1967, Y1968, Y1969,
    Y1970, Y1971, Y1972, Y1973, Y1974, Y1975, Y1976, Y1977, Y1978, Y1979,
    Y1980, Y1981, Y1982, Y1983, Y1984, Y1985, Y1986, Y1987, Y1988, Y1989,
    Y1990, Y1991, Y1992, Y1993, Y1994, Y1995, Y1996, Y1997, Y1998, Y1999,
    Y2000, Y2001, Y2002, Y2003, Y2004, Y2005, Y2006, Y2007, Y2008, Y2009,
    Y2010, Y2011, Y2012, Y2013, Y2014, Y2015, Y2016, Y2017, Y2018, Y2019,
    Y2020, Y2021, Y2022, Y2023, Y2024
) );

SELECT * from EXCHANGE_RATE_CLEAN;

CREATE OR REPLACE TABLE ECONOMIC_FACT AS
SELECT
    ex.COUNTRY_NAME,
    ex.COUNTRY_CODE,
    ex.YEAR,
    g.GDP_GROWTH,
    i.INFLATION_RATE,
    l.LENDING_INTEREST,
    ex.EXCHANGE_RATE
FROM EXCHANGE_RATE_CLEAN ex
LEFT JOIN GDP_GROWTH_CLEAN g
    ON ex.COUNTRY_CODE = g.COUNTRY_CODE AND ex.YEAR = g.YEAR
LEFT JOIN INFLATION_RATE_CLEAN i
    ON ex.COUNTRY_CODE = i.COUNTRY_CODE AND ex.YEAR = i.YEAR
LEFT JOIN LENDING_INTEREST_CLEAN l
    ON ex.COUNTRY_CODE = l.COUNTRY_CODE AND ex.YEAR = l.YEAR
ORDER BY COUNTRY_NAME, YEAR;


SELECT *
FROM ECONOMIC_FACT;

/*-------------------FOREX SCHEME---------------------------*/

CREATE SCHEMA IF NOT EXISTS BARCLAYS_ECON_DB.FOREX;

-- 3. Verify we are in correct database
USE DATABASE BARCLAYS_ECON_DB;
USE SCHEMA FOREX

-- USD / INR Forex
CREATE OR REPLACE TABLE FOREX.MARKET_USDINR (
    DATE VARCHAR,
    OPEN VARCHAR,
    HIGH VARCHAR,
    LOW VARCHAR,
    CLOSE VARCHAR,
    ADJ_CLOSE VARCHAR,
    VOLUME VARCHAR,
    CURRENCY VARCHAR
);

-- NIFTY
CREATE OR REPLACE TABLE FOREX.MARKET_NIFTY (
    DATE VARCHAR,
    OPEN VARCHAR,
    HIGH VARCHAR,
    LOW VARCHAR,
    CLOSE VARCHAR,
    ADJ_CLOSE VARCHAR,
    VOLUME VARCHAR,
    CURRENCY VARCHAR
);

-- S&P 500
CREATE OR REPLACE TABLE FOREX.MARKET_SP500 (
    DATE VARCHAR,
    OPEN VARCHAR,
    HIGH VARCHAR,
    LOW VARCHAR,
    CLOSE VARCHAR,
    ADJ_CLOSE VARCHAR,
    VOLUME VARCHAR,
    CURRENCY VARCHAR
);

-- FTSE 100
CREATE OR REPLACE TABLE FOREX.MARKET_FTSE (
    DATE VARCHAR,
    OPEN VARCHAR,
    HIGH VARCHAR,
    LOW VARCHAR,
    CLOSE VARCHAR,
    ADJ_CLOSE VARCHAR,
    VOLUME VARCHAR,
    CURRENCY VARCHAR
);


select * from FOREX.MARKET_USDINR


----------------------------
-- ✅ USD / INR CLEAN TABLE
----------------------------
CREATE OR REPLACE TABLE FOREX.MARKET_USDINR_CLEAN AS
SELECT
    TO_DATE(DATE,'DD-MON-YY') AS DATE,
    TRY_TO_DECIMAL(REPLACE(OPEN, ',', ''),10,4) AS OPEN,
    TRY_TO_DECIMAL(REPLACE(HIGH, ',', ''),10,4) AS HIGH,
    TRY_TO_DECIMAL(REPLACE(LOW, ',', ''),10,4) AS LOW,
    TRY_TO_DECIMAL(REPLACE(CLOSE, ',', ''),10,4) AS CLOSE,
    TRY_TO_DECIMAL(REPLACE(ADJ_CLOSE, ',', ''),10,4) AS ADJ_CLOSE,
    NULL AS VOLUME,          -- because USD-INR volume is always NULL
    CURRENCY
FROM FOREX.MARKET_USDINR;

select * from FOREX.MARKET_USDINR_CLEAN 
----------------------------
-- ✅ NIFTY CLEAN TABLE
----------------------------
CREATE OR REPLACE TABLE FOREX.MARKET_NIFTY_CLEAN AS
SELECT
    TO_DATE(DATE,'DD-MON-YY') AS DATE,
    TRY_TO_DECIMAL(REPLACE(OPEN, ',', ''),10,4) AS OPEN,
    TRY_TO_DECIMAL(REPLACE(HIGH, ',', ''),10,4) AS HIGH,
    TRY_TO_DECIMAL(REPLACE(LOW, ',', ''),10,4) AS LOW,
    TRY_TO_DECIMAL(REPLACE(CLOSE, ',', ''),10,4) AS CLOSE,
    TRY_TO_DECIMAL(REPLACE(ADJ_CLOSE, ',', ''),10,4) AS ADJ_CLOSE,
    TRY_TO_DECIMAL(REPLACE(VOLUME, ',', '')) AS VOLUME,
    CURRENCY
FROM FOREX.MARKET_NIFTY;

select * from FOREX.MARKET_NIFTY_CLEAN

----------------------------
-- ✅ S&P 500 CLEAN TABLE
----------------------------
CREATE OR REPLACE TABLE FOREX.MARKET_SP500_CLEAN AS
SELECT
    TO_DATE(DATE,'DD-MON-YY') AS DATE,
    TRY_TO_DECIMAL(REPLACE(OPEN, ',', ''),10,4) AS OPEN,
    TRY_TO_DECIMAL(REPLACE(HIGH, ',', ''),10,4) AS HIGH,
    TRY_TO_DECIMAL(REPLACE(LOW, ',', ''),10,4) AS LOW,
    TRY_TO_DECIMAL(REPLACE(CLOSE, ',', ''),10,4) AS CLOSE,
    TRY_TO_DECIMAL(REPLACE(ADJ_CLOSE, ',', ''),10,4) AS ADJ_CLOSE,
    TRY_TO_DECIMAL(REPLACE(VOLUME, ',', '')) AS VOLUME,
    CURRENCY
FROM FOREX.MARKET_SP500;

select * from forex.market_sp500_clean
----------------------------
-- ✅ FTSE 100 CLEAN TABLE
----------------------------
CREATE OR REPLACE TABLE FOREX.MARKET_FTSE_CLEAN AS
SELECT
    TO_DATE(DATE,'DD-MON-YY') AS DATE,
    TRY_TO_DECIMAL(REPLACE(OPEN, ',', ''),10,4) AS OPEN,
    TRY_TO_DECIMAL(REPLACE(HIGH, ',', ''),10,4) AS HIGH,
    TRY_TO_DECIMAL(REPLACE(LOW, ',', ''),10,4) AS LOW,
    TRY_TO_DECIMAL(REPLACE(CLOSE, ',', ''),10,4) AS CLOSE,
    TRY_TO_DECIMAL(REPLACE(ADJ_CLOSE, ',', ''),10,4) AS ADJ_CLOSE,
    TRY_TO_DECIMAL(REPLACE(VOLUME, ',', '')) AS VOLUME,
    CURRENCY
FROM FOREX.MARKET_FTSE;

select * from forex.market_ftse_clean



CREATE OR REPLACE TABLE FOREX.MARKET_FINAL AS
SELECT 'USDINR' AS MARKET, DATE, OPEN, HIGH, LOW, CLOSE, ADJ_CLOSE, VOLUME, CURRENCY
FROM FOREX.MARKET_USDINR_CLEAN

UNION ALL

SELECT 'NIFTY' AS MARKET, DATE, OPEN, HIGH, LOW, CLOSE, ADJ_CLOSE, VOLUME, CURRENCY
FROM FOREX.MARKET_NIFTY_CLEAN

UNION ALL

SELECT 'SP500' AS MARKET, DATE, OPEN, HIGH, LOW, CLOSE, ADJ_CLOSE, VOLUME, CURRENCY
FROM FOREX.MARKET_SP500_CLEAN

UNION ALL

SELECT 'FTSE' AS MARKET, DATE, OPEN, HIGH, LOW, CLOSE, ADJ_CLOSE, VOLUME, CURRENCY
FROM FOREX.MARKET_FTSE_CLEAN;

select * from MARKET_FINAL

CREATE OR REPLACE VIEW FOREX.MARKET_COMPARE AS
SELECT
    DATE,

    -- USDINR
    MAX(CASE WHEN MARKET = 'USDINR' THEN OPEN END)  AS USDINR_OPEN,
    MAX(CASE WHEN MARKET = 'USDINR' THEN HIGH END)  AS USDINR_HIGH,
    MAX(CASE WHEN MARKET = 'USDINR' THEN LOW END)   AS USDINR_LOW,
    MAX(CASE WHEN MARKET = 'USDINR' THEN CLOSE END) AS USDINR_CLOSE,
    MAX(CASE WHEN MARKET = 'USDINR' THEN VOLUME END) AS USDINR_VOLUME,
    MAX(CASE WHEN MARKET = 'USDINR' THEN CURRENCY END) AS USDINR_CURRENCY,

    -- NIFTY
    MAX(CASE WHEN MARKET = 'NIFTY' THEN OPEN END)  AS NIFTY_OPEN,
    MAX(CASE WHEN MARKET = 'NIFTY' THEN HIGH END)  AS NIFTY_HIGH,
    MAX(CASE WHEN MARKET = 'NIFTY' THEN LOW END)   AS NIFTY_LOW,
    MAX(CASE WHEN MARKET = 'NIFTY' THEN CLOSE END) AS NIFTY_CLOSE,
    MAX(CASE WHEN MARKET = 'NIFTY' THEN VOLUME END) AS NIFTY_VOLUME,
    MAX(CASE WHEN MARKET = 'NIFTY' THEN CURRENCY END) AS NIFTY_CURRENCY,

    -- SP500
    MAX(CASE WHEN MARKET = 'SP500' THEN OPEN END)  AS SP500_OPEN,
    MAX(CASE WHEN MARKET = 'SP500' THEN HIGH END)  AS SP500_HIGH,
    MAX(CASE WHEN MARKET = 'SP500' THEN LOW END)   AS SP500_LOW,
    MAX(CASE WHEN MARKET = 'SP500' THEN CLOSE END) AS SP500_CLOSE,
    MAX(CASE WHEN MARKET = 'SP500' THEN VOLUME END) AS SP500_VOLUME,
    MAX(CASE WHEN MARKET = 'SP500' THEN CURRENCY END) AS SP500_CURRENCY,

    -- FTSE
    MAX(CASE WHEN MARKET = 'FTSE' THEN OPEN END)  AS FTSE_OPEN,
    MAX(CASE WHEN MARKET = 'FTSE' THEN HIGH END)  AS FTSE_HIGH,
    MAX(CASE WHEN MARKET = 'FTSE' THEN LOW END)   AS FTSE_LOW,
    MAX(CASE WHEN MARKET = 'FTSE' THEN CLOSE END) AS FTSE_CLOSE,
    MAX(CASE WHEN MARKET = 'FTSE' THEN VOLUME END) AS FTSE_VOLUME,
    MAX(CASE WHEN MARKET = 'FTSE' THEN CURRENCY END) AS FTSE_CURRENCY

FROM FOREX.MARKET_FINAL
GROUP BY DATE
ORDER BY DATE;


SELECT * FROM FOREX.MARKET_COMPARE;


